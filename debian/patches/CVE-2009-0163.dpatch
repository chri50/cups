#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2009-0163.dpatch by Jamie Strandboge <jamie@ubuntu.com>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Upstream: STR #3031
## DP: Description: fix integer overflow via large TIFF file (CVE-2009-0163)

@DPATCH@
diff -urNad cups-1.3.9~/filter/image-private.h cups-1.3.9/filter/image-private.h
--- cups-1.3.9~/filter/image-private.h	2007-07-11 16:46:42.000000000 -0500
+++ cups-1.3.9/filter/image-private.h	2009-04-15 09:11:30.000000000 -0500
@@ -41,8 +41,8 @@
 
 #  define CUPS_IMAGE_MAX_WIDTH	0x07ffffff
 					/* 2^27-1 to allow for 15-channel data */
-#  define CUPS_IMAGE_MAX_HEIGHT	0x7fffffff
-					/* 2^31-1 */
+#  define CUPS_IMAGE_MAX_HEIGHT	0x3fffffff
+					/* 2^30-1 */
 
 #  define CUPS_TILE_SIZE	256	/* 256x256 pixel tiles */
 #  define CUPS_TILE_MINIMUM	10	/* Minimum number of tiles */
