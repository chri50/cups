Description: fix buffer overflow in cupsRasterReadPixels
Origin: upstream, https://www.cups.org/strfiles.php/3438/str4551.patch
Bug: https://www.cups.org/str.php?L4551
Bug-Debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=778387

Index: cups-1.5.3/filter/raster.c
===================================================================
--- cups-1.5.3.orig/filter/raster.c	2015-02-25 13:42:14.028329458 -0500
+++ cups-1.5.3/filter/raster.c	2015-02-25 13:42:14.024329427 -0500
@@ -284,7 +284,10 @@
   */
 
   if (!cups_raster_read_header(r))
+  {
+    memset(h, 0, sizeof(cups_page_header_t));
     return (0);
+  }
 
  /*
   * Copy the header to the user-supplied buffer...
@@ -313,7 +316,10 @@
   */
 
   if (!cups_raster_read_header(r))
+  {
+    memset(h, 0, sizeof(cups_page_header2_t));
     return (0);
+  }
 
  /*
   * Copy the header to the user-supplied buffer...
@@ -991,7 +997,7 @@
 
   cups_raster_update(r);
 
-  return (r->header.cupsBytesPerLine != 0 && r->header.cupsHeight != 0);
+  return (r->header.cupsBytesPerLine != 0 && r->header.cupsHeight != 0 && (r->header.cupsBytesPerLine % r->bpp) == 0);
 }
 
 
