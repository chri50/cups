#! /bin/sh /usr/share/dpatch/dpatch-run
# Description: fix cross-site scripting issue in web interface
# Origin: upstream, http://www.cups.org/strfiles.php/3268/str4356.patch
# Bug: http://www.cups.org/str.php?L4356

@DPATCH@
diff -urNad '--exclude=CVS' '--exclude=.svn' '--exclude=.git' '--exclude=.arch' '--exclude=.hg' '--exclude=_darcs' '--exclude=.bzr' cups-1.4.3~/scheduler/client.c cups-1.4.3/scheduler/client.c
--- cups-1.4.3~/scheduler/client.c	2014-04-18 11:58:59.000000000 -0400
+++ cups-1.4.3/scheduler/client.c	2014-04-18 11:59:15.132940510 -0400
@@ -4000,6 +4000,14 @@
     return (0);
 
  /*
+  * Check for "<" or quotes in the path and reject since this is probably
+  * someone trying to inject HTML...
+  */
+
+  if (strchr(path, '<') != NULL || strchr(path, '\"') != NULL || strchr(path, '\'') != NULL)
+    return (0);
+
+ /*
   * Check for "/.." in the path...
   */
 
