#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2009-0949.dpatch by Marc Deslauriers <marc.deslauriers@ubuntu.com>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Description: fix remote denial-of-service via IPP_TAG_UNSUPPORTED tags.
## DP: Patch: svn diff -c 8409 http://svn.easysw.com/public/cups/branches/branch-1.3/

@DPATCH@
diff -urNad cups-1.3.9~/scheduler/ipp.c cups-1.3.9/scheduler/ipp.c
--- cups-1.3.9~/scheduler/ipp.c	2009-06-01 10:24:14.000000000 -0400
+++ cups-1.3.9/scheduler/ipp.c	2009-06-01 10:24:36.000000000 -0400
@@ -321,7 +321,8 @@
       */
 
       attr = con->request->attrs;
-      if (attr && !strcmp(attr->name, "attributes-charset") &&
+      if (attr && attr->name &&
+          !strcmp(attr->name, "attributes-charset") &&
 	  (attr->value_tag & IPP_TAG_MASK) == IPP_TAG_CHARSET)
 	charset = attr;
       else
@@ -330,7 +331,8 @@
       if (attr)
         attr = attr->next;
 
-      if (attr && !strcmp(attr->name, "attributes-natural-language") &&
+      if (attr && attr->name &&
+          !strcmp(attr->name, "attributes-natural-language") &&
 	  (attr->value_tag & IPP_TAG_MASK) == IPP_TAG_LANGUAGE)
 	language = attr;
       else
